# 从零开始的微信硬件接入

## 一、目录

* 公众号申请与认证
* 开通设备功能
* 添加设备
* 开发接入流程
* 小程序的申请（非必须）
* 设备认证
* 测试并上线运营

## 二、公众号申请与认证

　　建议申请的公众号类型为*服务号*，以企业名义申请并进行认证！
　　
### 申请流程如下：

第一步：  访问网址：[微信公众平台](https://mp.weixin.qq.com/) ，进入后如下图所示：


![微信公众平台首页](/home/lsy/Documents/home.jpeg  "微信公众平台首页")


第二步：点击上图红框标识的*[立即注册](https://mp.weixin.qq.com/cgi-bin/registermidpage?action=index&lang=zh_CN)*按钮，进入选择公众号类型的页面，如下图所示：

![选择公众号类型](/home/lsy/Documents/choose_type.jpeg  "选择公众号类型")

第三步： 选择上图中的服务号，进入下一步，如下图所示：

![填写信息](/home/lsy/Documents/info_input.jpeg  "填写信息")

输入邮箱，注意此邮箱输入后，即为微信公众号登录的用户名，请确保邮箱真实有效，并不要丢失。密码填写后请牢记。

输入邮箱点击确认后，微信会发送一份邮件至您所填写的邮箱内，请打开邮箱，页面会跳转至邮箱激活页面，如下图：

![邮箱激活](/home/lsy/Documents/register.jpeg  "邮箱激活")


第四步：打开邮箱之后，点击邮件红色框位置的链接，以激活注册。如下图所示：

![邮箱激活内容](/home/lsy/Documents/mail_message.jpeg  "邮箱激活内容")

再次强调，请务必记住您的邮箱！当激活之后，将会跳转选择类型的页面。

第五步： 选择类型页面如下图：

![选择公众号类型](/home/lsy/Documents/choose_type_2.jpeg  "选择公众号类型")

您可以选择左边的*订阅号*类型，也可以选择红框标记的*服务号*类型（这里选择服务号），点击红框下*“选择并继续”*，会弹出提示信息，如下图：

![提示信息展示](/home/lsy/Documents/tips.jpeg  "提示信息展示")

点击确定即可！注意，确定之后公众号类型不能再更改！

第六步：在完成选择类型的操作后，会进入信息登记页面，如下图：

![信息登记](/home/lsy/Documents/register_info.jpeg  "信息登记")

选择红框中主体类型：企业。选择完毕，跳转进入填写信息的页面。

第七步：填写企业和运营者信息页面如下：

![填写企业和运营者信息](/home/lsy/Documents/input_info_2.jpeg  "填写企业和运营者信息")

按微信提示信息填写“主体信息登记”进行公众号注册。

注意：运营者姓名，即为微信公众号管理员。

以上信息填写完成后，会出现“运营者身份验证”，二维码需用个人微信扫描，扫码前注意个人微信需绑定与本人相关的一张银行卡（此为微信判断，上述运营者姓名身份证号信息，填写是否真实的凭据）请放心绑定银行卡后并扫码，扫码图片如下：

![扫码确认照片](/home/lsy/Documents/qrcode.jpeg  "扫码确认照片")

扫码之后，点击*继续*按钮，会弹出确认填写信息页面，点击确定即可，如下图：

![确认信息](/home/lsy/Documents/.jpeg  "确认信息")

第八步： 最后在确认公众号信息之后，需要填写公众号名称等内容，如下图：

![公众号可见内容](/home/lsy/Documents/gongzhonghao_info.jpeg  "公众号可见内容")

正式进入“公众号信息”填写阶段，请填写公众号名称。

*建议*：名称为用户搜索公众号的条件之一，相当于关键词搜索功能，我们建议使用中文，或大众熟知的英文，尽量减少使用简写，更有利于用户搜索到您的公众号。

*注意*：此过程仅为注册，如名称填写后还想修改，可以在认证过程中再次修改，但每次修改需向微信公众号缴纳300元。

第九步：在上面八个步骤都操作完成后，微信公众号就注册完成了，这时需要进一步微信认证才能使用微信公众号的各项内容。

未对公众号进行认证，请在30天内进行认证。认证工作与注册公众号，不是一个连贯流程的操作，可以由企业准备好相关资料后，另找时间操作。

认证位置：登录微信平台，左侧设置-微信认证，点击进行认证。由于认证工作，需企业上传营业执照等相关信息，建议您自己操作认证部分。

![](/home/lsy/Documents/renzheng.jpeg) 

![](/home/lsy/Documents/renzheng2.jpeg) 

### 认证流程（企业类型）如下：

第一步：登录微信公众平台=》设置=》微信认证=》开通

![开通认证](/home/lsy/Documents/start.jpg  "开通认证")

第二步：身份验证

![身份认证](/home/lsy/Documents/start2.jpg  "身份认证")

第三步： 勾选同意《微信公众平台认证服务协议》

![同意协议](/home/lsy/Documents/start3.jpg  "同意协议")

第四步：选择认证类型及填写认证资料

选择认证类型

![选择认证类型](/home/lsy/Documents/start4.jpg) 

企业业务资料填写

![](/home/lsy/Documents/start5.jpg) 

![](/home/lsy/Documents/start5_1.png) 


运营者信息填写

![运营者信息填写](/home/lsy/Documents/start8_1.jpg  "运营者信息填写")


企业基本资料上传

![企业基本资料上传](/home/lsy/Documents/start7.jpg  "企业基本资料上传")

第五步：确认名称

公众号名称可以选择3种命名方式：基于商标命名、基于媒体名命名、基于自选词汇；

![](/home/lsy/Documents/start_9_1.jpg) 


第六步：选择发票

![](/home/lsy/Documents/start9.jpg) 

第七步：支付费用

![](/home/lsy/Documents/start10.jpg) 

第八步：认证审核

我司收到打款后，会及时将该帐号认证申请派发给第三方审核公司进行审核。

![](/home/lsy/Documents/start11.jpg) 

温馨提示：

1、银行转账不是即时到账，所以还请耐心等待5个工作日左右
2、我司收到打款后会在小信封通知对应审核公司名称及联系方式

认证完成后，公众号就正式可用了！

## 三、开通设备功能并添加设备

下面的操作针对设备商云连接微信硬件云通道的配置接入，流程如下：

![设备商云接入](/home/lsy/Documents/shebeishangyunjieru.png  "设备商云接入")

接入步骤如下：

第一步：登录微信公众平台，点击左边功能栏的"添加功能插件"，选择"设备功能"。

![添加功能](/home/lsy/Documents/shebeijieru_1.png  "添加功能")

点击"开通"，阅读并同意《微信公众平台微信互联设备功能服务协议》。

![](/home/lsy/Documents/shebeijieru_2.png) 

![](/home/lsy/Documents/shebeijieru_3.png) 

第二步：添加产品

进行产品开发前，第三方需要在"公众平台-设备功能"内添加接入的产品。一个公众号允许添加多种产品（比如可以添加N款音箱和N款车机），每种添加成功的产品都默认获得微信硬件平台分配的100个设备授权配额。

2.1进入"设备功能"，点击"添加产品"

![添加产品](/home/lsy/Documents/shebeijieru_4.png) 

2.2产品基础资料登记

![产品基础资料登记](/home/lsy/Documents/shebeijieru_5_1.png) 

其中，接入方案中勾选“微信硬件云标准接入方案”——厂商云连接微信硬件云通道。“厂商云连接微信硬件云通道”即：

![厂商云连接微信硬件云操作](/home/lsy/Documents/shebeijieru_6.png) 

2.3产品能力登记

![产品能力登记](/home/lsy/Documents/shebeijieru_7.png) 

这样添加产品就完成了！

## 四、开发接入流程

### 1. 接入方案介绍

设备接入方案即设备接入微信硬件平台使用的数据传输方案，目前包含平台基础接入方案与微信硬件云标准接入方案。

1.平台基础接入方案
适用对象：
（1）拥有后台服务器的设备厂商
（2）希望在公众号体系内独立实现设备相关功能（即不需要微信硬件平台提供的产品标准能力）
（3）希望设备可以收发微信消息（图片／音乐／文件／地理位置等）

微信硬件平台是基于微信公众平台基础构建的，微信公众平台基础技术架构如下图所示。

![微信平台技术架构](/home/lsy/Documents/jishujiagou_1.jpg  "微信平台技术架构")


公众号运营分为编辑模式和开发模式。

在编辑模式下，公众号运营者登录微信公众号管理页面，通过手动方式编辑消息和管理用户。
在开发模式下，运营者可以获得更多高级的接口功能（包括设备功能），通过编写消息接口程序，让第三方服务器自动管理用户和消息。

![微信硬件平台基础接入方案技术架构](/home/lsy/Documents/jishujiagou_2.jpg) 

在这个基础架构里，设备厂家必须有自己的服务器，通过硬件平台基础消息接口，接收设备和用户消息，提供设备服务。

2.微信硬件云标准接入方案
适用对象：希望通过微信硬件平台提供的产品标准能力集定义设备数据，实现设备数据互联互通的设备。

（1）设备直连微信硬件云通道
微信硬件平台为设备提供直连数据通道，设备可以通过直连SDK直接接入微信硬件服务器，打通设备到云端的通道。框架下图所示：

![直连数据通道](/home/lsy/Documents/jierujiagou_1.png  "直连数据通道")

在直连方案中，微信硬件平台将提供设备信息管理、绑定关系存储、设备权限管理、设备固件版本控制、设备数据统计、数据登录鉴权、状态更新、固件更新等服务。

具体描述：请参照文档[新增直连数据通道](http://iot.weixin.qq.com/wiki/new/index.html?page=3-3) 

（2）设备商云连接微信硬件云通道
设备连接厂商服务器后，可通过设备openAPI与微信硬件云对接。框架如下图所示：

![设备商云接入通道](/home/lsy/Documents/jierujiagou_2.png  "设备商云接入通道")

目前，设备厂商可通过微信硬件平台提供的开发模式接入设备。整体技术架构如图5所示：

![整体技术架构](/home/lsy/Documents/jishujiagou_3.jpg  "整体技术架构")

